# GNNé…ä½“å—ä½“é¢„æµ‹æ¨¡å‹

åŸºäºå›¾ç¥ç»ç½‘ç»œçš„é…ä½“å—ä½“ç›¸äº’ä½œç”¨é¢„æµ‹æ·±åº¦å­¦ä¹ æ¨¡å‹ï¼Œä¸“ä¸ºåŸºå› è¡¨è¾¾æ•°æ®è®¾è®¡ã€‚

## ğŸ¯ é¡¹ç›®æ¦‚è¿°

- **ç›®æ ‡**: åŸºäºåŸºå› è¡¨è¾¾æ•°æ®é¢„æµ‹é…ä½“å—ä½“å¯¹åˆ†æ•°
- **æ•°æ®è§„æ¨¡**: 468,260æ ·æœ¬ Ã— 5,051åŸºå›  â†’ 1,120é…ä½“å—ä½“å¯¹
- **æ ¸å¿ƒæŠ€æœ¯**: å±‚æ¬¡åŒ–å›¾æ³¨æ„åŠ›ç½‘ç»œ (H-GAT)
- **ç‰¹è‰²åŠŸèƒ½**: è‡ªåŠ¨GPUèµ„æºç®¡ç†ã€æ··åˆç²¾åº¦è®­ç»ƒã€è¶…å‚æ•°ä¼˜åŒ–

## ğŸ“ é¡¹ç›®ç»“æ„

```
xenium_gnn/
â”œâ”€â”€ config.yaml                 # ä¸»é…ç½®æ–‡ä»¶
â”œâ”€â”€ requirements.txt            # ä¾èµ–åŒ…åˆ—è¡¨
â”œâ”€â”€ setup_env.sh               # ç¯å¢ƒè®¾ç½®è„šæœ¬
â”œâ”€â”€ train.py                   # ä¸»è®­ç»ƒè„šæœ¬
â”œâ”€â”€ README.md                  # é¡¹ç›®è¯´æ˜
â”œâ”€â”€ src/                       # æºä»£ç 
â”‚   â”œâ”€â”€ data/
â”‚   â”‚   â””â”€â”€ preprocessing.py   # æ•°æ®é¢„å¤„ç†
â”‚   â”œâ”€â”€ models/
â”‚   â”‚   â””â”€â”€ gnn_model.py      # GNNæ¨¡å‹æ¶æ„
â”‚   â”œâ”€â”€ training/
â”‚   â”‚   â”œâ”€â”€ trainer.py        # è®­ç»ƒå™¨
â”‚   â”‚   â””â”€â”€ hyperopt.py       # è¶…å‚æ•°ä¼˜åŒ–
â”‚   â”œâ”€â”€ evaluation/
â”‚   â”‚   â””â”€â”€ evaluator.py      # æ¨¡å‹è¯„ä¼°
â”‚   â””â”€â”€ utils/
â”‚       â””â”€â”€ gpu_utils.py      # GPUå·¥å…·
â”œâ”€â”€ data/                      # æ•°æ®æ–‡ä»¶
â”‚   â”œâ”€â”€ x.csv                 # åŸºå› è¡¨è¾¾çŸ©é˜µ
â”‚   â”œâ”€â”€ y.csv                 # é…ä½“å—ä½“åˆ†æ•°
â”‚   â””â”€â”€ pathway_gene.csv      # é€šè·¯åŸºå› æ˜ å°„
â”œâ”€â”€ models/                    # ä¿å­˜çš„æ¨¡å‹
â”œâ”€â”€ logs/                      # è®­ç»ƒæ—¥å¿—
â””â”€â”€ results/                   # ç»“æœè¾“å‡º
```

## ğŸš€ å¿«é€Ÿå¼€å§‹

### 1. ç¯å¢ƒå‡†å¤‡

ç¡®ä¿æ‚¨åœ¨condaçš„deeplearningç¯å¢ƒä¸­ï¼š

```bash
# æ¿€æ´»ç¯å¢ƒå¹¶æ£€æŸ¥
source setup_env.sh
```

### 2. å®‰è£…ä¾èµ–

```bash
# åœ¨deeplearningç¯å¢ƒä¸­å®‰è£…
conda activate deeplearning
pip install -r requirements.txt
```

### 3. æ•°æ®å‡†å¤‡

ç¡®ä¿æ•°æ®æ–‡ä»¶ä½äºæ­£ç¡®ä½ç½®ï¼š
- `../data/x.csv`: åŸºå› è¡¨è¾¾çŸ©é˜µ
- `../data/y.csv`: é…ä½“å—ä½“åˆ†æ•°
- `../data/pathway_gene.csv`: é€šè·¯åŸºå› æ˜ å°„

### 4. æ¨¡å‹è®­ç»ƒ

```bash
# åŸºç¡€è®­ç»ƒ
python train.py --mode train

# è¶…å‚æ•°ä¼˜åŒ–
python train.py --mode hyperopt

# æ¨¡å‹è¯„ä¼°
python train.py --mode evaluate
```

## âš™ï¸ é…ç½®è¯´æ˜

ä¸»è¦é…ç½®é¡¹åœ¨`config.yaml`ä¸­ï¼š

### æ¨¡å‹é…ç½®
- `gene_embedding_dim`: åŸºå› åµŒå…¥ç»´åº¦ (é»˜è®¤: 128)
- `hidden_dim`: éšè—å±‚ç»´åº¦ (é»˜è®¤: 256)
- `gat_layers`: GATå±‚æ•° (é»˜è®¤: 3)
- `attention_heads`: æ³¨æ„åŠ›å¤´æ•° (é»˜è®¤: 8)

### è®­ç»ƒé…ç½®
- `batch_size`: æ‰¹æ¬¡å¤§å° (é»˜è®¤: 64)
- `learning_rate`: å­¦ä¹ ç‡ (é»˜è®¤: 0.001)
- `epochs`: è®­ç»ƒè½®æ•° (é»˜è®¤: 100)
- `patience`: æ—©åœè€å¿ƒå€¼ (é»˜è®¤: 15)

### GPUé…ç½®
- `use_gpu`: æ˜¯å¦ä½¿ç”¨GPU (é»˜è®¤: true)
- `mixed_precision`: æ··åˆç²¾åº¦è®­ç»ƒ (é»˜è®¤: true)
- `device_ids`: GPUè®¾å¤‡IDåˆ—è¡¨ (é»˜è®¤: [0])

## ğŸ”§ æ ¸å¿ƒåŠŸèƒ½

### 1. è‡ªåŠ¨GPUèµ„æºç®¡ç†
- è‡ªåŠ¨æ£€æµ‹å¯ç”¨GPU
- æ™ºèƒ½é€‰æ‹©æœ€ä½³GPU
- åŠ¨æ€å†…å­˜ç®¡ç†
- æ··åˆç²¾åº¦è®­ç»ƒæ”¯æŒ

### 2. å±‚æ¬¡åŒ–å›¾æ³¨æ„åŠ›ç½‘ç»œ
- åŸºå› åµŒå…¥å±‚
- å¤šå±‚GATå¤„ç†
- é€šè·¯çº§ç‰¹å¾èšåˆ
- æ®‹å·®è¿æ¥å’Œå±‚å½’ä¸€åŒ–

### 3. æ™ºèƒ½è®­ç»ƒç­–ç•¥
- è‡ªé€‚åº”å­¦ä¹ ç‡è°ƒåº¦
- æ—©åœæœºåˆ¶
- æ¢¯åº¦è£å‰ª
- æ£€æŸ¥ç‚¹ä¿å­˜

### 4. è¶…å‚æ•°ä¼˜åŒ–
- Optunaæ¡†æ¶
- TPEé‡‡æ ·å™¨
- ä¸­ä½æ•°å‰ªæ
- å¯è§†åŒ–ç»“æœ

### 5. å…¨é¢è¯„ä¼°
- å¤šç§å›å½’æŒ‡æ ‡
- æŒ‰ç›®æ ‡å˜é‡è¯„ä¼°
- é¢„æµ‹ç»“æœå¯è§†åŒ–
- æ®‹å·®åˆ†æ

## ğŸ“Š æ¨¡å‹æ¶æ„

```python
GNNLigandReceptorModel(
  (gene_embedding): Embedding(5051, 128)
  (input_projection): Linear(1, 128)
  (gat): HierarchicalGAT(
    (gat_layers): ModuleList(
      (0-2): 3 x GATConv(128, 128, heads=8)
    )
    (layer_norms): ModuleList(
      (0-2): 3 x LayerNorm
    )
  )
  (pathway_aggregator): PathwayAggregator(128, 256)
  (predictor): Sequential(
    (0): Linear(256, 512)
    (1): ReLU()
    (2): Dropout(0.1)
    (3): Linear(512, 256)
    (4): ReLU()
    (5): Dropout(0.1)
    (6): Linear(256, 1120)
  )
)
```

## ğŸ“ˆ æ€§èƒ½æŒ‡æ ‡

### ç›®æ ‡æ€§èƒ½
- **MSE**: < 0.1 (ç›®æ ‡) / < 0.05 (ä¼˜ç§€)
- **RÂ²**: > 0.7 (ç›®æ ‡) / > 0.85 (ä¼˜ç§€)
- **Pearsonç›¸å…³**: > 0.8 (ç›®æ ‡) / > 0.9 (ä¼˜ç§€)

### è®­ç»ƒæ•ˆç‡
- **å•epochæ—¶é—´**: < 5åˆ†é’Ÿ (GPU)
- **å†…å­˜ä½¿ç”¨**: è‡ªåŠ¨ä¼˜åŒ–
- **æ··åˆç²¾åº¦**: æ”¯æŒFP16åŠ é€Ÿ

## ğŸ› ï¸ é«˜çº§ç”¨æ³•

### 1. è‡ªå®šä¹‰é…ç½®

```bash
# ä½¿ç”¨è‡ªå®šä¹‰é…ç½®æ–‡ä»¶
python train.py --config my_config.yaml --mode train
```

### 2. æ¢å¤è®­ç»ƒ

```bash
# ä»æ£€æŸ¥ç‚¹æ¢å¤
python train.py --checkpoint models/checkpoint_epoch_50.pth --mode train
```

### 3. è°ƒæ•´æ—¥å¿—çº§åˆ«

```bash
# è¯¦ç»†è°ƒè¯•ä¿¡æ¯
python train.py --log-level DEBUG --mode train
```

### 4. æŒ‡å®šcondaç¯å¢ƒ

```bash
# æŒ‡å®šç¯å¢ƒåç§°
python train.py --conda-env my_dl_env --mode train
```

## ğŸ” æ•…éšœæ’é™¤

### å¸¸è§é—®é¢˜

1. **CUDAå†…å­˜ä¸è¶³**
   - å‡å°‘batch_size
   - å¯ç”¨æ··åˆç²¾åº¦è®­ç»ƒ
   - ä½¿ç”¨æ¢¯åº¦ç´¯ç§¯

2. **è®­ç»ƒæ”¶æ•›æ…¢**
   - è°ƒæ•´å­¦ä¹ ç‡
   - æ£€æŸ¥æ•°æ®æ ‡å‡†åŒ–
   - ä½¿ç”¨å­¦ä¹ ç‡è°ƒåº¦å™¨

3. **GPUæœªè¢«è¯†åˆ«**
   - æ£€æŸ¥CUDAå®‰è£…
   - éªŒè¯PyTorch GPUæ”¯æŒ
   - ç¡®è®¤GPUé©±åŠ¨ç‰ˆæœ¬

### æ€§èƒ½ä¼˜åŒ–å»ºè®®

1. **æ•°æ®åŠ è½½ä¼˜åŒ–**
   - å¢åŠ num_workers
   - å¯ç”¨pin_memory
   - ä½¿ç”¨SSDå­˜å‚¨æ•°æ®

2. **æ¨¡å‹ä¼˜åŒ–**
   - è°ƒæ•´æ¨¡å‹å¤§å°
   - ä½¿ç”¨çŸ¥è¯†è’¸é¦
   - æ¨¡å‹å‰ªæ

3. **è®­ç»ƒä¼˜åŒ–**
   - æ··åˆç²¾åº¦è®­ç»ƒ
   - åˆ†å¸ƒå¼è®­ç»ƒ
   - æ¢¯åº¦æ£€æŸ¥ç‚¹

## ğŸ“ æ›´æ–°æ—¥å¿—

### v1.0.0 (2024-01)
- åˆå§‹ç‰ˆæœ¬å‘å¸ƒ
- åŸºç¡€GNNæ¨¡å‹å®ç°
- è‡ªåŠ¨GPUç®¡ç†
- è¶…å‚æ•°ä¼˜åŒ–æ”¯æŒ
- å®Œæ•´è¯„ä¼°ä½“ç³»

## ğŸ¤ è´¡çŒ®æŒ‡å—

1. Forké¡¹ç›®
2. åˆ›å»ºç‰¹æ€§åˆ†æ”¯
3. æäº¤æ›´æ”¹
4. æ¨é€åˆ°åˆ†æ”¯
5. åˆ›å»ºPull Request

## ğŸ“„ è®¸å¯è¯

æœ¬é¡¹ç›®é‡‡ç”¨MITè®¸å¯è¯ - è¯¦è§LICENSEæ–‡ä»¶

## ğŸ“ è”ç³»æ–¹å¼

å¦‚æœ‰é—®é¢˜æˆ–å»ºè®®ï¼Œè¯·è”ç³»ï¼š
- é‚®ç®±: [your-email@example.com]
- é¡¹ç›®åœ°å€: [GitHubé“¾æ¥]

---

**æ³¨æ„**: è¯·ç¡®ä¿åœ¨deeplearning condaç¯å¢ƒä¸­è¿è¡Œæ‰€æœ‰å‘½ä»¤ï¼Œå¹¶æ ¹æ®æ‚¨çš„ç¡¬ä»¶é…ç½®è°ƒæ•´ç›¸å…³å‚æ•°ã€‚